---
layout: post
title: 机房搬迁总结
categories: python
description: 遇到的坑及解决办法
keywords: linux
---

  由于公司原有机房合同到期，因此需要搬迁。新机房和旧机房是在一栋楼，所以搬迁也就是从2楼搬到3楼。
  
  今天，搬迁工作终于接近尾声。从9月5号开始做准备，至今已经接近2个月。搬迁中虽然遇到过一些小问题，但好在都能在客户使用前得以解决。
  
  在此也要感谢网络组，dba同学的鼎力支持。
  
  此文主要记录搬迁中遇到的问题及解决办法。
  
  
  ## 信息统计
  
  共计69台机器，其中90%机器系统均为ESXI 5.x，虚拟机居多，实际虚机有450台，由于CMDB里有统计不全或统计错误的问题，期间编写了获取ESXI 下虚机
  
  信息的脚本，参见 [get_esxi_host_and_vm_info](https://github.com/xoyabc/scripts/tree/master/get_esxi_host_and_vm_info)
  
  - 确认哪些机器需要搬迁，
  - 统计机器的SN号和所在机柜
  - 宿主机下所有虚拟机的IP地址，所属服务，开机自启设置
  - 宿主机下各个网口(vmnic0-11)所属vlan
  - 有心跳线的设备及对端设备IP
  - 心跳线所在网口及对端设备心跳线网口(heartbeat健康检查采用心跳线直连，避免广播风暴影响)
  - 确认各个机器所属的环境(一共有6套环境)
  - 确认机柜数量&机柜电压&电流上限
  - 3楼单机柜位置可容纳机器数量（10个）
  
  
